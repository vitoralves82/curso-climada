<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulador Interativo de Ciclones Tropicais - CLIMADA</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: #333;
            line-height: 1.6;
        }
        .map-container {
            height: 500px;
            width: 100%;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .control-panel {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .metrics-panel {
            background-color: #f8fafc;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .explanation-box {
            background-color: #f0f9ff;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
        }
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
        }
        .code-comment {
            color: #94a3b8;
        }
        .slider-container {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .slider-container label {
            min-width: 150px;
        }
        .slider-container input {
            flex-grow: 1;
        }
        .slider-container span {
            min-width: 50px;
            text-align: right;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tab-button {
            padding: 8px 16px;
            border-radius: 8px 8px 0 0;
            cursor: pointer;
            background-color: #e5e7eb;
        }
        .tab-button.active {
            background-color: #3b82f6;
            color: white;
        }
        .chart-container {
            height: 300px;
            width: 100%;
        }
        .ship-icon {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #3b82f6;
            border-radius: 50%;
            border: 2px solid white;
            opacity: 0.8;
            transform: translate(-50%, -50%);
        }
        .ship-icon.affected {
            background-color: #ef4444;
        }
        .header-gradient {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
        }
        .scenario-button {
            transition: all 0.3s ease;
        }
        .scenario-button.active {
            background-color: #1d4ed8;
            color: white;
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Cabeçalho -->
    <header class="header-gradient text-white py-6 px-4 md:px-6 mb-6">
        <div class="container mx-auto">
            <h1 class="text-3xl font-bold">Simulador Interativo de Ciclones Tropicais</h1>
            <p class="text-xl mt-2">Módulo de Precificação de Riscos Climáticos com CLIMADA</p>
        </div>
    </header>

    <main class="container mx-auto px-4 md:px-6 pb-12">
        <!-- Introdução -->
        <section class="mb-10">
            <h2 class="text-2xl font-bold mb-4">Visualize o Impacto de Ciclones Tropicais em Ativos Offshore</h2>
            <p class="mb-4">
                Este simulador permite visualizar e analisar os potenciais impactos de ciclones tropicais em embarcações offshore usando a plataforma CLIMADA. 
                Ajuste os parâmetros do ciclone, escolha diferentes cenários climáticos e observe como as mudanças afetam os danos esperados e o risco financeiro associado.
            </p>
            <div class="explanation-box p-4 mb-6">
                <h3 class="font-bold text-lg mb-2">Como usar este simulador:</h3>
                <ol class="list-decimal pl-6">
                    <li>Escolha um cenário climático (atual, RCP 4.5 ou RCP 8.5)</li>
                    <li>Ajuste os parâmetros do ciclone tropical usando os controles deslizantes</li>
                    <li>Observe os impactos nas embarcações e as métricas de risco calculadas</li>
                    <li>Exporte os resultados para análise posterior</li>
                </ol>
            </div>
        </section>

        <!-- Controles de Cenário Climático -->
        <section class="mb-8">
            <h3 class="text-xl font-bold mb-4">Cenário Climático</h3>
            <div class="flex flex-wrap gap-4">
                <button id="scenario-current" class="scenario-button active py-2 px-4 bg-blue-100 hover:bg-blue-200 rounded-lg border border-blue-300 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    Cenário Atual
                </button>
                <button id="scenario-rcp45" class="scenario-button py-2 px-4 bg-blue-100 hover:bg-blue-200 rounded-lg border border-blue-300 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" />
                    </svg>
                    RCP 4.5 (2050)
                </button>
                <button id="scenario-rcp85" class="scenario-button py-2 px-4 bg-blue-100 hover:bg-blue-200 rounded-lg border border-blue-300 flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                    </svg>
                    RCP 8.5 (2050)
                </button>
            </div>
        </section>

        <!-- Simulador Principal -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-10">
            <!-- Mapa e Visualização -->
            <div class="lg:col-span-2">
                <h3 class="text-xl font-bold mb-4">Mapa de Impacto</h3>
                <div id="map" class="map-container"></div>
                <div class="flex justify-between items-center mt-4">
                    <button id="play-button" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded flex items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        Simular Trajetória
                    </button>
                    <div class="flex items-center">
                        <span class="mr-2">Tempo: </span>
                        <span id="simulation-time" class="font-mono">00:00</span>
                    </div>
                </div>
            </div>

            <!-- Painel de Controle -->
            <div class="control-panel p-4">
                <h3 class="text-xl font-bold mb-4">Parâmetros do Ciclone</h3>
                
                <div class="slider-container">
                    <label for="wind-speed">Velocidade do Vento:</label>
                    <input type="range" id="wind-speed" min="50" max="300" value="150" class="w-full">
                    <span id="wind-speed-value">150 km/h</span>
                </div>
                
                <div class="slider-container">
                    <label for="cyclone-radius">Raio do Ciclone:</label>
                    <input type="range" id="cyclone-radius" min="50" max="500" value="200" class="w-full">
                    <span id="cyclone-radius-value">200 km</span>
                </div>
                
                <div class="slider-container">
                    <label for="cyclone-speed">Velocidade de Deslocamento:</label>
                    <input type="range" id="cyclone-speed" min="10" max="80" value="30" class="w-full">
                    <span id="cyclone-speed-value">30 km/h</span>
                </div>
                
                <div class="slider-container">
                    <label for="track-angle">Ângulo da Trajetória:</label>
                    <input type="range" id="track-angle" min="0" max="360" value="45" class="w-full">
                    <span id="track-angle-value">45°</span>
                </div>
                
                <div class="slider-container">
                    <label for="central-pressure">Pressão Central:</label>
                    <input type="range" id="central-pressure" min="850" max="1000" value="950" class="w-full">
                    <span id="central-pressure-value">950 hPa</span>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">Categoria do Ciclone:</h4>
                    <div id="hurricane-category" class="py-2 px-4 bg-yellow-500 text-white font-bold rounded-full text-center">
                        Categoria 4
                    </div>
                </div>
                
                <div class="mt-6">
                    <h4 class="font-bold mb-2">Posição Inicial:</h4>
                    <div class="grid grid-cols-2 gap-2">
                        <div>
                            <label for="start-lat" class="block text-sm">Latitude:</label>
                            <input type="text" id="start-lat" value="25.0" class="w-full p-2 border rounded">
                        </div>
                        <div>
                            <label for="start-lon" class="block text-sm">Longitude:</label>
                            <input type="text" id="start-lon" value="-75.0" class="w-full p-2 border rounded">
                        </div>
                    </div>
                    <button id="reset-cyclone" class="mt-4 w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded">
                        Redefinir Parâmetros
                    </button>
                </div>
            </div>
        </div>

        <!-- Painel de Métricas e Resultados -->
        <section class="mb-10">
            <h3 class="text-xl font-bold mb-4">Resultados e Métricas de Risco</h3>
            
            <div class="flex flex-wrap mb-4">
                <div class="flex mb-4 w-full">
                    <button class="tab-button active" data-tab="impact-metrics">Métricas de Impacto</button>
                    <button class="tab-button" data-tab="damage-distribution">Distribuição de Danos</button>
                    <button class="tab-button" data-tab="asset-status">Status dos Ativos</button>
                </div>
            </div>
            
            <div class="bg-white p-6 rounded-lg shadow-md">
                <!-- Métricas de Impacto -->
                <div id="impact-metrics" class="tab-content active">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="metrics-panel p-4">
                            <h4 class="font-bold text-lg mb-2">Perda Anual Esperada (AAL)</h4>
                            <div class="text-3xl font-bold text-blue-600">$12.8 M</div>
                            <p class="text-sm text-gray-600 mt-2">Valor esperado de perdas anuais devido a ciclones tropicais</p>
                        </div>
                        
                        <div class="metrics-panel p-4">
                            <h4 class="font-bold text-lg mb-2">Perda Máxima Provável (PML)</h4>
                            <div class="text-3xl font-bold text-red-600">$145.2 M</div>
                            <p class="text-sm text-gray-600 mt-2">Perda para evento de 200 anos de período de retorno</p>
                        </div>
                        
                        <div class="metrics-panel p-4">
                            <h4 class="font-bold text-lg mb-2">Ativos Afetados</h4>
                            <div class="text-3xl font-bold text-orange-600">42%</div>
                            <p class="text-sm text-gray-600 mt-2">Percentual do valor total exposto afetado pelo evento</p>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold text-lg mb-2">Curva de Excedência de Probabilidade</h4>
                        <div class="chart-container">
                            <canvas id="exceedance-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Distribuição de Danos -->
                <div id="damage-distribution" class="tab-content">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-bold text-lg mb-2">Distribuição Espacial de Danos</h4>
                            <div class="chart-container">
                                <canvas id="spatial-damage-chart"></canvas>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-bold text-lg mb-2">Danos por Tipo de Embarcação</h4>
                            <div class="chart-container">
                                <canvas id="vessel-type-chart"></canvas>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mt-6">
                        <h4 class="font-bold text-lg mb-2">Componentes do Dano</h4>
                        <div class="chart-container">
                            <canvas id="damage-components-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Status dos Ativos -->
                <div id="asset-status" class="tab-content">
                    <div class="mb-4">
                        <input type="text" id="asset-search" placeholder="Buscar por embarcação..." class="w-full p-2 border rounded">
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full bg-white">
                            <thead>
                                <tr>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">ID</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Tipo</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Valor (USD)</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Latitude</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Longitude</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Intensidade</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Dano (%)</th>
                                    <th class="py-2 px-4 border-b border-gray-200 bg-gray-100 text-left">Status</th>
                                </tr>
                            </thead>
                            <tbody id="asset-table-body">
                                <tr>
                                    <td class="py-2 px-4 border-b border-gray-200">FPSO-001</td>
                                    <td class="py-2 px-4 border-b border-gray-200">FPSO</td>
                                    <td class="py-2 px-4 border-b border-gray-200">$380,000,000</td>
                                    <td class="py-2 px-4 border-b border-gray-200">25.4</td>
                                    <td class="py-2 px-4 border-b border-gray-200">-74.8</td>
                                    <td class="py-2 px-4 border-b border-gray-200">210 km/h</td>
                                    <td class="py-2 px-4 border-b border-gray-200">68%</td>
                                    <td class="py-2 px-4 border-b border-gray-200"><span class="py-1 px-2 bg-red-100 text-red-800 rounded-full text-xs">Dano Severo</span></td>
                                </tr>
                                <tr>
                                    <td class="py-2 px-4 border-b border-gray-200">DRILL-002</td>
                                    <td class="py-2 px-4 border-b border-gray-200">Plataforma</td>
                                    <td class="py-2 px-4 border-b border-gray-200">$250,000,000</td>
                                    <td class="py-2 px-4 border-b border-gray-200">24.9</td>
                                    <td class="py-2 px-4 border-b border-gray-200">-75.2</td>
                                    <td class="py-2 px-4 border-b border-gray-200">180 km/h</td>
                                    <td class="py-2 px-4 border-b border-gray-200">42%</td>
                                    <td class="py-2 px-4 border-b border-gray-200"><span class="py-1 px-2 bg-orange-100 text-orange-800 rounded-full text-xs">Dano Moderado</span></td>
                                </tr>
                                <tr>
                                    <td class="py-2 px-4 border-b border-gray-200">SUP-003</td>
                                    <td class="py-2 px-4 border-b border-gray-200">Embarcação de Apoio</td>
                                    <td class="py-2 px-4 border-b border-gray-200">$45,000,000</td>
                                    <td class="py-2 px-4 border-b border-gray-200">25.1</td>
                                    <td class="py-2 px-4 border-b border-gray-200">-75.5</td>
                                    <td class="py-2 px-4 border-b border-gray-200">120 km/h</td>
                                    <td class="py-2 px-4 border-b border-gray-200">18%</td>
                                    <td class="py-2 px-4 border-b border-gray-200"><span class="py-1 px-2 bg-yellow-100 text-yellow-800 rounded-full text-xs">Dano Leve</span></td>
                                </tr>
                                <tr>
                                    <td class="py-2 px-4 border-b border-gray-200">FPSO-004</td>
                                    <td class="py-2 px-4 border-b border-gray-200">FPSO</td>
                                    <td class="py-2 px-4 border-b border-gray-200">$420,000,000</td>
                                    <td class="py-2 px-4 border-b border-gray-200">24.7</td>
                                    <td class="py-2 px-4 border-b border-gray-200">-74.3</td>
                                    <td class="py-2 px-4 border-b border-gray-200">90 km/h</td>
                                    <td class="py-2 px-4 border-b border-gray-200">5%</td>
                                    <td class="py-2 px-4 border-b border-gray-200"><span class="py-1 px-2 bg-green-100 text-green-800 rounded-full text-xs">Dano Mínimo</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="flex justify-end mt-4">
                <button id="export-csv" class="mr-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                    </svg>
                    Exportar CSV
                </button>
                <button id="export-json" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4" />
                    </svg>
                    Exportar JSON
                </button>
            </div>
        </section>

        <!-- Descrição do Modelo -->
        <section class="mb-10">
            <h3 class="text-xl font-bold mb-4">Como o Modelo CLIMADA Funciona</h3>
            
            <div class="explanation-box p-6">
                <p class="mb-4">
                    O CLIMADA é uma plataforma de código aberto para análise quantitativa de risco climático e avaliação de opções de adaptação. Para calcular o impacto de ciclones tropicais em ativos offshore, o CLIMADA utiliza três componentes principais:
                </p>
                
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 my-6">
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h4 class="font-bold text-lg mb-2 text-blue-600">1. Perigo (Hazard)</h4>
                        <p>
                            Representa a distribuição espacial e temporal da intensidade do ciclone tropical (velocidade do vento, altura de ondas). É modelado através do TCTracks e TropCyclone para criar campos de vento realistas.
                        </p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h4 class="font-bold text-lg mb-2 text-blue-600">2. Exposição (Exposure)</h4>
                        <p>
                            Descreve a localização, valor e características das embarcações offshore. Cada ativo é georreferenciado e possui atributos específicos como tipo, valor e características técnicas.
                        </p>
                    </div>
                    
                    <div class="bg-white p-4 rounded-lg shadow-sm">
                        <h4 class="font-bold text-lg mb-2 text-blue-600">3. Vulnerabilidade (Impact Function)</h4>
                        <p>
                            Define a relação entre a intensidade do perigo e o dano esperado. Para embarcações offshore, considera danos estruturais e interrupções operacionais em função da velocidade do vento e altura de ondas.
                        </p>
                    </div>
                </div>
                
                <p class="mb-4">
                    O processo de cálculo segue estas etapas:
                </p>
                
                <ol class="list-decimal pl-6 mb-4">
                    <li>Modelagem da trajetória e intensidade do ciclone tropical</li>
                    <li>Cálculo dos campos de vento e ondas ao longo da trajetória</li>
                    <li>Determinação da intensidade do perigo em cada localização de ativo</li>
                    <li>Aplicação das funções de impacto para estimar o dano para cada ativo</li>
                    <li>Agregação dos resultados para calcular métricas de risco (AAL, PML, etc.)</li>
                </ol>
                
                <p>
                    Para cenários de mudanças climáticas, o CLIMADA implementa ajustes baseados em projeções científicas, como o aumento da intensidade máxima e mudanças na frequência de ciclones tropicais sob diferentes cenários RCP.
                </p>
            </div>
        </section>

        <!-- Código Python Exemplo -->
        <section class="mb-10">
            <h3 class="text-xl font-bold mb-4">Código Python Simplificado</h3>
            
            <p class="mb-4">
                Abaixo está um exemplo simplificado de como o cálculo de impacto para ciclones tropicais é implementado no CLIMADA:
            </p>
            
            <pre class="code-block p-6 mb-4">
<span class="code-comment"># Importar bibliotecas necessárias</span>
from climada.hazard import TCTracks, TropCyclone, Centroids
from climada.entity import Exposures, ImpactFuncSet, ImpfTropCyclone
from climada.engine import Impact

<span class="code-comment"># 1. Configurar trajetória do ciclone</span>
tr_cyclone = TCTracks()
track = tr_cyclone.generate_synthetic_track(
    basin='NA',  <span class="code-comment"># North Atlantic</span>
    initial_pos=(-75.0, 25.0),  <span class="code-comment"># longitude, latitude</span>
    wind_speed=150,  <span class="code-comment"># km/h</span>
    central_pressure=950,  <span class="code-comment"># hPa</span>
    radius_max_wind=200,  <span class="code-comment"># km</span>
    track_angle=45  <span class="code-comment"># degrees</span>
)

<span class="code-comment"># 2. Definir pontos de cálculo (centroids)</span>
cent = Centroids.from_pnt_bounds(
    (-80, 20, -70, 30),  <span class="code-comment"># Coordenadas: min_lon, min_lat, max_lon, max_lat</span>
    res=0.1  <span class="code-comment"># resolução em graus</span>
)

<span class="code-comment"># 3. Calcular perigo (hazard) a partir da trajetória</span>
tc_hazard = TropCyclone.from_tracks(tr_cyclone, centroids=cent)

<span class="code-comment"># 4. Implementar mudanças climáticas (se necessário)</span>
if scenario == 'RCP4.5':
    tc_hazard = tc_hazard.apply_climate_scenario_knu(ref_year=2050, rcp_scenario=45)
elif scenario == 'RCP8.5':
    tc_hazard = tc_hazard.apply_climate_scenario_knu(ref_year=2050, rcp_scenario=85)

<span class="code-comment"># 5. Carregar exposição de embarcações offshore</span>
exp_offshore = Exposures()
exp_offshore.read_csv('offshore_vessels.csv')  <span class="code-comment"># Arquivo com localização e valor das embarcações</span>
exp_offshore.gdf['impf_TC'] = 1  <span class="code-comment"># Associar à função de impacto ID 1</span>
exp_offshore.check()

<span class="code-comment"># 6. Definir funções de impacto para diferentes tipos de embarcações</span>
imp_func_set = ImpactFuncSet()
imp_func_fpso = ImpfTropCyclone.from_emanuel_usa() <span class="code-comment"># Função base a ser ajustada</span>
imp_func_fpso.id = 1
imp_func_fpso.haz_type = 'TC'
imp_func_set.append(imp_func_fpso)

<span class="code-comment"># 7. Calcular impacto</span>
impact = Impact()
impact.calc(exp_offshore, imp_func_set, tc_hazard)

<span class="code-comment"># 8. Analisar resultados</span>
print(f"Average Annual Loss: ${impact.aai_agg / 1e6:.1f} milhões")
print(f"Probable Maximum Loss (200yr): ${impact.calc_pml(return_periods=(200))[0] / 1e6:.1f} milhões")
print(f"Percentage of Assets Affected: {impact.eai_exp[impact.eai_exp > 0].count() / len(impact.eai_exp) * 100:.1f}%")

<span class="code-comment"># 9. Visualizar resultados</span>
impact.plot_basemap_eai_exposure()  <span class="code-comment"># Mapa de impacto anual esperado</span>
impact.plot_hexbin_eai_exposure()   <span class="code-comment"># Visualização de densidade de impacto</span>
impact.calc_freq_curve().plot()     <span class="code-comment"># Curva de excedência de probabilidade</span>
            </pre>
            
            <p class="mb-4">
                Este código ilustra o fluxo básico de análise no CLIMADA. Na prática, análises mais complexas podem incluir múltiplos cenários, diferentes tipos de perigos combinados, e medidas de adaptação.
            </p>
        </section>
    </main>

    <footer class="bg-gray-800 text-white py-8 px-4">
        <div class="container mx-auto">
            <div class="flex flex-col md:flex-row justify-between">
                <div class="mb-6 md:mb-0">
                    <h3 class="text-xl font-bold mb-4">Precificação de Riscos Climáticos com CLIMADA</h3>
                    <p>Um curso completo para quantificação e precificação de riscos climáticos para ativos corporativos</p>
                </div>
                
                <div>
                    <h4 class="font-bold mb-2">Recursos Adicionais</h4>
                    <ul>
                        <li><a href="#" class="text-blue-300 hover:text-blue-100">Documentação do CLIMADA</a></li>
                        <li><a href="#" class="text-blue-300 hover:text-blue-100">GitHub do Projeto</a></li>
                        <li><a href="#" class="text-blue-300 hover:text-blue-100">Comunidade de Usuários</a></li>
                        <li><a href="#" class="text-blue-300 hover:text-blue-100">Tutoriais em Vídeo</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-gray-700 text-sm text-gray-400">
                <p>© 2023 Curso CLIMADA. Todos os direitos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    
    <script>
        // Inicialização do mapa
        const map = L.map('map').setView([25, -75], 6);
        
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Dados simulados para embarcações offshore
        const offshoreAssets = [
            { id: 'FPSO-001', type: 'FPSO', value: 380000000, lat: 25.4, lon: -74.8 },
            { id: 'DRILL-002', type: 'Plataforma', value: 250000000, lat: 24.9, lon: -75.2 },
            { id: 'SUP-003', type: 'Embarcação de Apoio', value: 45000000, lat: 25.1, lon: -75.5 },
            { id: 'FPSO-004', type: 'FPSO', value: 420000000, lat: 24.7, lon: -74.3 },
            { id: 'DRILL-005', type: 'Plataforma', value: 280000000, lat: 25.6, lon: -74.9 },
            { id: 'SUP-006', type: 'Embarcação de Apoio', value: 38000000, lat: 24.5, lon: -75.0 },
            { id: 'FPSO-007', type: 'FPSO', value: 410000000, lat: 25.2, lon: -74.5 },
            { id: 'DRILL-008', type: 'Plataforma', value: 270000000, lat: 24.8, lon: -74.7 },
        ];
        
        // Adicionar marcadores para as embarcações
        const assetMarkers = [];
        offshoreAssets.forEach(asset => {
            const marker = L.marker([asset.lat, asset.lon], {
                icon: L.divIcon({
                    className: 'ship-icon',
                    html: '',
                    iconSize: [20, 20]
                })
            }).addTo(map);
            
            marker.bindPopup(`
                <strong>${asset.id}</strong><br>
                Tipo: ${asset.type}<br>
                Valor: $${(asset.value / 1000000).toFixed(1)} milhões
            `);
            
            assetMarkers.push({
                asset: asset,
                marker: marker
            });
        });
        
        // Ciclone tropical
        let cyclone = {
            lat: parseFloat(document.getElementById('start-lat').value),
            lon: parseFloat(document.getElementById('start-lon').value),
            windSpeed: 150,
            radius: 200,
            speed: 30,
            angle: 45,
            pressure: 950,
            path: [],
            marker: null,
            circle: null
        };
        
        // Inicializar visualização do ciclone
        function initCyclone() {
            // Adicionar marcador para o centro do ciclone
            if (cyclone.marker) map.removeLayer(cyclone.marker);
            cyclone.marker = L.marker([cyclone.lat, cyclone.lon], {
                icon: L.divIcon({
                    className: 'text-red-600',
                    html: '<div class="bg-red-600 rounded-full w-6 h-6 border-2 border-white"></div>',
                    iconSize: [24, 24]
                })
            }).addTo(map);
            
            // Adicionar círculo para o raio do ciclone
            if (cyclone.circle) map.removeLayer(cyclone.circle);
            cyclone.circle = L.circle([cyclone.lat, cyclone.lon], {
                radius: cyclone.radius * 1000, // Converter para metros
                color: 'red',
                fillColor: '#f03',
                fillOpacity: 0.15,
                weight: 1
            }).addTo(map);
            
            // Limpar caminho anterior
            cyclone.path = [];
        }
        
        initCyclone();
        
        // Atualizar visualização do ciclone baseado nos controles
        function updateCycloneParameters() {
            cyclone.windSpeed = parseInt(document.getElementById('wind-speed').value);
            cyclone.radius = parseInt(document.getElementById('cyclone-radius').value);
            cyclone.speed = parseInt(document.getElementById('cyclone-speed').value);
            cyclone.angle = parseInt(document.getElementById('track-angle').value);
            cyclone.pressure = parseInt(document.getElementById('central-pressure').value);
            cyclone.lat = parseFloat(document.getElementById('start-lat').value);
            cyclone.lon = parseFloat(document.getElementById('start-lon').value);
            
            // Atualizar valores exibidos
            document.getElementById('wind-speed-value').textContent = cyclone.windSpeed + ' km/h';
            document.getElementById('cyclone-radius-value').textContent = cyclone.radius + ' km';
            document.getElementById('cyclone-speed-value').textContent = cyclone.speed + ' km/h';
            document.getElementById('track-angle-value').textContent = cyclone.angle + '°';
            document.getElementById('central-pressure-value').textContent = cyclone.pressure + ' hPa';
            
            // Atualizar categoria do ciclone
            let category = 0;
            if (cyclone.windSpeed >= 118) category = 1;
            if (cyclone.windSpeed >= 154) category = 2;
            if (cyclone.windSpeed >= 178) category = 3;
            if (cyclone.windSpeed >= 209) category = 4;
            if (cyclone.windSpeed >= 252) category = 5;
            
            const categoryElement = document.getElementById('hurricane-category');
            categoryElement.textContent = 'Categoria ' + category;
            
            // Ajustar cor baseada na categoria
            categoryElement.className = 'py-2 px-4 text-white font-bold rounded-full text-center ';
            if (category === 1) categoryElement.className += 'bg-blue-500';
            else if (category === 2) categoryElement.className += 'bg-green-500';
            else if (category === 3) categoryElement.className += 'bg-yellow-500';
            else if (category === 4) categoryElement.className += 'bg-orange-500';
            else if (category === 5) categoryElement.className += 'bg-red-500';
            else categoryElement.className += 'bg-gray-500';
            
            // Atualizar visualização
            initCyclone();
        }
        
        // Adicionar event listeners para os controles
        document.getElementById('wind-speed').addEventListener('input', updateCycloneParameters);
        document.getElementById('cyclone-radius').addEventListener('input', updateCycloneParameters);
        document.getElementById('cyclone-speed').addEventListener('input', updateCycloneParameters);
        document.getElementById('track-angle').addEventListener('input', updateCycloneParameters);
        document.getElementById('central-pressure').addEventListener('input', updateCycloneParameters);
        document.getElementById('reset-cyclone').addEventListener('click', function() {
            document.getElementById('wind-speed').value = 150;
            document.getElementById('cyclone-radius').value = 200;
            document.getElementById('cyclone-speed').value = 30;
            document.getElementById('track-angle').value = 45;
            document.getElementById('central-pressure').value = 950;
            document.getElementById('start-lat').value = 25.0;
            document.getElementById('start-lon').value = -75.0;
            updateCycloneParameters();
        });
        
        // Controles de cenário
        const scenarioButtons = document.querySelectorAll('.scenario-button');
        scenarioButtons.forEach(button => {
            button.addEventListener('click', function() {
                scenarioButtons.forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                
                // Atualizar cenário
                const scenarioId = this.id;
                if (scenarioId === 'scenario-rcp45') {
                    // Aplicar ajustes de RCP 4.5 (aumento médio de intensidade)
                    document.getElementById('wind-speed').value = Math.round(cyclone.windSpeed * 1.08);
                } else if (scenarioId === 'scenario-rcp85') {
                    // Aplicar ajustes de RCP 8.5 (aumento maior de intensidade)
                    document.getElementById('wind-speed').value = Math.round(cyclone.windSpeed * 1.15);
                } else {
                    // Cenário atual - sem mudanças
                }
                
                updateCycloneParameters();
                updateCharts(); // Atualizar gráficos baseados no novo cenário
            });
        });
        
        // Simulação da trajetória do ciclone
        let simulationInterval;
        let simulationTime = 0;
        
        document.getElementById('play-button').addEventListener('click', function() {
            // Limpar qualquer simulação anterior
            if (simulationInterval) {
                clearInterval(simulationInterval);
                simulationInterval = null;
                this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Simular Trajetória';
                return;
            }
            
            // Inicializar simulação
            updateCycloneParameters();
            simulationTime = 0;
            document.getElementById('simulation-time').textContent = '00:00';
            this.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Parar Simulação';
            
            // Desenhar caminho do ciclone com linha
            const pathLine = L.polyline([], {
                color: 'red',
                weight: 2,
                opacity: 0.7,
                dashArray: '5, 5'
            }).addTo(map);
            
            // Resetar status dos ativos
            assetMarkers.forEach(am => {
                am.marker.getElement().classList.remove('affected');
                am.damage = 0;
                am.intensity = 0;
                am.status = 'Não afetado';
            });
            
            simulationInterval = setInterval(() => {
                simulationTime += 1;
                
                // Atualizar tempo de simulação
                const hours = Math.floor(simulationTime / 60).toString().padStart(2, '0');
                const minutes = (simulationTime % 60).toString().padStart(2, '0');
                document.getElementById('simulation-time').textContent = `${hours}:${minutes}`;
                
                // Mover o ciclone
                const angleRadians = cyclone.angle * Math.PI / 180;
                const speedPerMinute = cyclone.speed / 60; // km/min
                // Converter para graus (aproximação simples)
                const lonMove = speedPerMinute * Math.cos(angleRadians) / 111.32 / Math.cos(cyclone.lat * Math.PI / 180);
                const latMove = speedPerMinute * Math.sin(angleRadians) / 110.574;
                
                cyclone.lon += lonMove;
                cyclone.lat += latMove;
                
                // Atualizar posição no mapa
                cyclone.marker.setLatLng([cyclone.lat, cyclone.lon]);
                cyclone.circle.setLatLng([cyclone.lat, cyclone.lon]);
                
                // Adicionar ao caminho
                cyclone.path.push([cyclone.lat, cyclone.lon]);
                pathLine.setLatLngs(cyclone.path);
                
                // Verificar impacto nas embarcações
                assetMarkers.forEach(am => {
                    const distance = map.distance([cyclone.lat, cyclone.lon], [am.asset.lat, am.asset.lon]) / 1000; // km
                    
                    if (distance <= cyclone.radius) {
                        // Calcular intensidade do vento baseado na distância do centro
                        // Modelo simplificado de Holland (1980)
                        const r = distance / cyclone.radius;
                        let intensity = 0;
                        
                        if (r < 0.5) {
                            // Região interna - vento aumenta até o raio de vento máximo
                            intensity = cyclone.windSpeed * (r * 2);
                        } else if (r <= 1) {
                            // Região externa - vento diminui após o raio de vento máximo
                            intensity = cyclone.windSpeed * (1 - 0.4 * (r - 0.5) / 0.5);
                        }
                        
                        // Calcular dano usando uma função de impacto simplificada
                        let damage = 0;
                        if (intensity > 80) {
                            // Função de impacto simplificada: começa em 80 km/h, aumenta não-linearmente
                            const normalizedIntensity = (intensity - 80) / 300;
                            damage = Math.min(100, Math.pow(normalizedIntensity, 1.5) * 100);
                        }
                        
                        // Atualizar status visual se for a maior intensidade até agora
                        if (intensity > (am.intensity || 0)) {
                            am.intensity = intensity;
                            am.damage = damage;
                            
                            if (damage > 50) {
                                am.marker.getElement().classList.add('affected');
                                am.status = 'Dano Severo';
                            } else if (damage > 25) {
                                am.marker.getElement().classList.add('affected');
                                am.status = 'Dano Moderado';
                            } else if (damage > 10) {
                                am.status = 'Dano Leve';
                            } else if (damage > 0) {
                                am.status = 'Dano Mínimo';
                            }
                        }
                    }
                });
                
                // Parar simulação após 4 horas (240 minutos)
                if (simulationTime >= 240) {
                    clearInterval(simulationInterval);
                    simulationInterval = null;
                    document.getElementById('play-button').innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" /><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>Simular Trajetória';
                    
                    // Atualizar tabela de ativos
                    updateAssetTable();
                    
                    // Atualizar gráficos
                    updateCharts();
                }
            }, 100); // Acelerar a simulação (100ms = 1 minuto na simulação)
        });
        
        function updateAssetTable() {
            const tableBody = document.getElementById('asset-table-body');
            tableBody.innerHTML = '';
            
            assetMarkers.forEach(am => {
                // Determinar classe CSS baseada no status
                let statusClass = 'bg-gray-100 text-gray-800';
                if (am.status === 'Dano Severo') {
                    statusClass = 'bg-red-100 text-red-800';
                } else if (am.status === 'Dano Moderado') {
                    statusClass = 'bg-orange-100 text-orange-800';
                } else if (am.status === 'Dano Leve') {
                    statusClass = 'bg-yellow-100 text-yellow-800';
                } else if (am.status === 'Dano Mínimo') {
                    statusClass = 'bg-green-100 text-green-800';
                }
                
                // Adicionar linha à tabela
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="py-2 px-4 border-b border-gray-200">${am.asset.id}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${am.asset.type}</td>
                    <td class="py-2 px-4 border-b border-gray-200">$${(am.asset.value / 1000000).toFixed(1)}M</td>
                    <td class="py-2 px-4 border-b border-gray-200">${am.asset.lat.toFixed(1)}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${am.asset.lon.toFixed(1)}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${am.intensity ? Math.round(am.intensity) + ' km/h' : 'N/A'}</td>
                    <td class="py-2 px-4 border-b border-gray-200">${am.damage ? Math.round(am.damage) + '%' : '0%'}</td>
                    <td class="py-2 px-4 border-b border-gray-200"><span class="py-1 px-2 ${statusClass} rounded-full text-xs">${am.status || 'Não afetado'}</span></td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // Funcionalidade para as abas
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                // Remover classe active de todos os botões e conteúdos
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // Adicionar classe active ao botão clicado
                this.classList.add('active');
                
                // Ativar conteúdo correspondente
                const tabId = this.getAttribute('data-tab');
                document.getElementById(tabId).classList.add('active');
            });
        });
        
        // Inicialização dos gráficos
        let exceedanceChart, spatialDamageChart, vesselTypeChart, damageComponentsChart;
        
        function initCharts() {
            // Gráfico de curva de excedência
            const exceedanceCtx = document.getElementById('exceedance-chart').getContext('2d');
            exceedanceChart = new Chart(exceedanceCtx, {
                type: 'line',
                data: {
                    labels: ['1', '2', '5', '10', '20', '50', '100', '200', '500', '1000'],
                    datasets: [{
                        label: 'Perdas (Milhões USD)',
                        data: [180, 152, 120, 95, 75, 52, 35, 22, 12, 5],
                        borderColor: 'rgba(59, 130, 246, 1)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Período de Retorno (anos)'
                            },
                            type: 'logarithmic'
                        },
                        y: {
                            title: {
                                display: true,
                                text: 'Perda (Milhões USD)'
                            },
                            beginAtZero: true
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Curva de Excedência de Probabilidade'
                        }
                    }
                }
            });
            
            // Gráfico de distribuição espacial
            const spatialDamageCtx = document.getElementById('spatial-damage-chart').getContext('2d');
            spatialDamageChart = new Chart(spatialDamageCtx, {
                type: 'bar',
                data: {
                    labels: ['Região A', 'Região B', 'Região C', 'Região D'],
                    datasets: [{
                        label: 'Perda Total (Milhões USD)',
                        data: [45, 68, 32, 18],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(245, 158, 11, 0.6)',
                            'rgba(239, 68, 68, 0.6)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Perda (Milhões USD)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Perdas por Região'
                        }
                    }
                }
            });
            
            // Gráfico por tipo de embarcação
            const vesselTypeCtx = document.getElementById('vessel-type-chart').getContext('2d');
            vesselTypeChart = new Chart(vesselTypeCtx, {
                type: 'pie',
                data: {
                    labels: ['FPSO', 'Plataformas', 'Embarcações de Apoio'],
                    datasets: [{
                        label: 'Perda por Tipo (Milhões USD)',
                        data: [72, 58, 15],
                        backgroundColor: [
                            'rgba(59, 130, 246, 0.6)',
                            'rgba(16, 185, 129, 0.6)',
                            'rgba(245, 158, 11, 0.6)'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Danos por Tipo de Embarcação'
                        }
                    }
                }
            });
            
            // Gráfico de componentes de danos
            const damageComponentsCtx = document.getElementById('damage-components-chart').getContext('2d');
            damageComponentsChart = new Chart(damageComponentsCtx, {
                type: 'bar',
                data: {
                    labels: ['Estrutural', 'Equipamentos', 'Interrupção de Operação', 'Evacuação', 'Outros'],
                    datasets: [{
                        label: 'Custo (Milhões USD)',
                        data: [48, 35, 75, 12, 8],
                        backgroundColor: 'rgba(59, 130, 246, 0.6)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Custo (Milhões USD)'
                            }
                        }
                    },
                    plugins: {
                        title: {
                            display: true,
                            text: 'Componentes do Dano'
                        }
                    }
                }
            });
        }
        
        function updateCharts() {
            // Cálculo básico das perdas baseado na simulação
            let totalDamage = 0;
            const damageByType = {
                'FPSO': 0,
                'Plataforma': 0,
                'Embarcação de Apoio': 0
            };
            
            assetMarkers.forEach(am => {
                const damageValue = (am.damage || 0) * am.asset.value / 100;
                totalDamage += damageValue;
                
                if (damageByType[am.asset.type] !== undefined) {
                    damageByType[am.asset.type] += damageValue;
                }
            });
            
            // Converter para milhões
            totalDamage = totalDamage / 1000000;
            for (const type in damageByType) {
                damageByType[type] = damageByType[type] / 1000000;
            }
            
            // Atualizar dados do gráfico de excedência
            const activeScenario = document.querySelector('.scenario-button.active').id;
            let scenarioFactor = 1;
            if (activeScenario === 'scenario-rcp45') {
                scenarioFactor = 1.2; // Aumento de 20% para RCP 4.5
            } else if (activeScenario === 'scenario-rcp85') {
                scenarioFactor = 1.4; // Aumento de 40% para RCP 8.5
            }
            
            // Aplicar fator do cenário aos dados da curva de excedência
            const baseData = [180, 152, 120, 95, 75, 52, 35, 22, 12, 5];
            exceedanceChart.data.datasets[0].data = baseData.map(val => val * scenarioFactor);
            exceedanceChart.update();
            
            // Atualizar gráfico por tipo de embarcação
            vesselTypeChart.data.datasets[0].data = [
                damageByType['FPSO'] || 0,
                damageByType['Plataforma'] || 0,
                damageByType['Embarcação de Apoio'] || 0
            ];
            vesselTypeChart.update();
            
            // Atualizar valores nas métricas
            document.querySelector('#impact-metrics .text-blue-600').textContent = `$${(totalDamage * 0.1).toFixed(1)} M`;
            document.querySelector('#impact-metrics .text-red-600').textContent = `$${(totalDamage * 1.1).toFixed(1)} M`;
            
            // Calcular percentual de ativos afetados
            const affectedAssets = assetMarkers.filter(am => (am.damage || 0) > 0).length;
            const percentAffected = (affectedAssets / assetMarkers.length * 100).toFixed(0);
            document.querySelector('#impact-metrics .text-orange-600').textContent = `${percentAffected}%`;
        }
        
        // Inicializar os gráficos
        initCharts();
        
        // Busca na tabela de ativos
        document.getElementById('asset-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const rows = document.getElementById('asset-table-body').getElementsByTagName('tr');
            
            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            }
        });
        
        // Funcionalidade para exportação
        document.getElementById('export-csv').addEventListener('click', function() {
            let csvContent = "data:text/csv;charset=utf-8,";
            csvContent += "ID,Tipo,Valor,Latitude,Longitude,Intensidade,Dano,Status\n";
            
            assetMarkers.forEach(am => {
                const row = [
                    am.asset.id,
                    am.asset.type,
                    am.asset.value,
                    am.asset.lat,
                    am.asset.lon,
                    am.intensity || 0,
                    am.damage || 0,
                    am.status || 'Não afetado'
                ].join(',');
                csvContent += row + "\n";
            });
            
            const encodedUri = encodeURI(csvContent);
            const link = document.createElement("a");
            link.setAttribute("href", encodedUri);
            link.setAttribute("download", "dados_simulacao_climada.csv");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
        
        document.getElementById('export-json').addEventListener('click', function() {
            const data = {
                scenario: document.querySelector('.scenario-button.active').id,
                cyclone: {
                    windSpeed: cyclone.windSpeed,
                    radius: cyclone.radius,
                    speed: cyclone.speed,
                    angle: cyclone.angle,
                    pressure: cyclone.pressure,
                    path: cyclone.path
                },
                assets: assetMarkers.map(am => ({
                    id: am.asset.id,
                    type: am.asset.type,
                    value: am.asset.value,
                    lat: am.asset.lat,
                    lon: am.asset.lon,
                    intensity: am.intensity || 0,
                    damage: am.damage || 0,
                    status: am.status || 'Não afetado'
                })),
                simulationTime: simulationTime
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(jsonString);
            const link = document.createElement('a');
            link.setAttribute("href", dataStr);
            link.setAttribute("download", "simulacao_climada.json");
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        });
    </script>
</body>
</html>
